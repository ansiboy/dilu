{"version":3,"sources":["../out/formValidator.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","errors_1","require","FormValidator","form","validateOnChanged","errors","argumentNull","fields","elementEvents","field","push","map","o","errorElement","filter","forEach","style","display","name","fieldErrorElement","error","removeProperty","innerHTML","element","querySelectorAll","elementNotExists","getElementsByClassName","errorClassName","fieldElement","document","createElement","className","nextSibling","parentElement","insertBefore","appendChild","ps","Array","i","length","condition","p","checkField","checkFieldAsync","all","checkResults","isAsync","validateFunc","checking","catch","addEventListener","tagName","bindElementEvent","depends","j","dependResult","Error","dependIsOK","rules","rule","fieldElementCanntNull","elementValue","isPass","validate","showElement","console","assert","elementName","errorText","replace"],"mappings":"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","sourcesContent":["\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst errors_1 = require(\"./errors\");\r\n/**\r\n * 表单验证器，用于对表单中的字段进行验证\r\n */\r\nclass FormValidator {\r\n    constructor(form, ...fields) {\r\n        /** 输入框的值发生改变，是否重新校验该输入框的值，默认为 true */\r\n        this.validateOnChanged = true;\r\n        if (!form)\r\n            throw errors_1.errors.argumentNull('form');\r\n        this.fields = fields || [];\r\n        this.form = form;\r\n        this.elementEvents = {};\r\n    }\r\n    appendField(field) {\r\n        this.fields.push(field);\r\n    }\r\n    /**\r\n     * 清除表单的错误信息\r\n     */\r\n    clearErrors() {\r\n        this.fields.map(o => o.errorElement)\r\n            .filter(o => o != null)\r\n            .forEach(o => o.style.display = 'none');\r\n    }\r\n    /**\r\n     * 清除表单的指定元素错误信息\r\n     * @param name 指定的元素名称\r\n     */\r\n    clearElementError(name) {\r\n        if (!name)\r\n            throw errors_1.errors.argumentNull('name');\r\n        let fields = this.fields.filter(o => o.name == name);\r\n        for (let field of fields) {\r\n            let errorElement = this.fieldErrorElement(field);\r\n            errorElement.style.display = 'none';\r\n        }\r\n    }\r\n    /**\r\n     * 设置表单的指定元素错误信息\r\n     * @param name 指定的元素名称\r\n     * @param error 错误信息\r\n     */\r\n    setElementError(name, error) {\r\n        if (!name)\r\n            throw errors_1.errors.argumentNull('name');\r\n        if (!error)\r\n            throw errors_1.errors.argumentNull('error');\r\n        let fields = this.fields.filter(o => o.name == name);\r\n        for (let field of fields) {\r\n            let errorElement = this.fieldErrorElement(field);\r\n            errorElement.style.removeProperty('display');\r\n            errorElement.innerHTML = error;\r\n        }\r\n    }\r\n    fieldElement(field) {\r\n        let name = field.name;\r\n        let element = this.form.querySelectorAll(`[name='${name}']`)[0];\r\n        if (element == null)\r\n            throw errors_1.errors.elementNotExists(name);\r\n        return element;\r\n    }\r\n    fieldErrorElement(field) {\r\n        if (!field.errorElement) {\r\n            let errorElement = this.form.getElementsByClassName(`${FormValidator.errorClassName} ${field.name}`)[0];\r\n            if (!errorElement) {\r\n                let element = this.fieldElement(field);\r\n                errorElement = document.createElement(\"span\");\r\n                errorElement.className = FormValidator.errorClassName;\r\n                errorElement.style.display = 'none';\r\n                if (element.nextSibling)\r\n                    element.parentElement.insertBefore(errorElement, element.nextSibling);\r\n                else\r\n                    element.parentElement.appendChild(errorElement);\r\n            }\r\n            field.errorElement = errorElement;\r\n        }\r\n        return field.errorElement;\r\n        // return errorElement;\r\n    }\r\n    /**\r\n     * 验证字段\r\n     */\r\n    check() {\r\n        let ps = new Array();\r\n        for (let i = 0; i < this.fields.length; i++) {\r\n            let field = this.fields[i];\r\n            let element = this.fieldElement(field);\r\n            if (field.condition && field.condition(element) == false)\r\n                continue;\r\n            let p = this.checkField(field);\r\n            ps.push(p);\r\n        }\r\n        let result = ps.filter(o => o == false).length == 0;\r\n        return result;\r\n    }\r\n    /**\r\n     * 异步验证字段\r\n     */\r\n    checkAsync() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let ps = new Array();\r\n            for (let i = 0; i < this.fields.length; i++) {\r\n                let field = this.fields[i];\r\n                let element = this.fieldElement(field);\r\n                if (field.condition && field.condition(element) == false)\r\n                    continue;\r\n                let p = this.checkFieldAsync(field);\r\n                ps.push(p);\r\n            }\r\n            let checkResults = yield Promise.all(ps);\r\n            let result = checkResults.filter(o => o == false).length == 0;\r\n            return result;\r\n        });\r\n    }\r\n    bindElementEvent(field, isAsync) {\r\n        if (this.elementEvents[field.name]) {\r\n            return;\r\n        }\r\n        let element = this.fieldElement(field);\r\n        let validateFunc = (() => {\r\n            let checking = false;\r\n            return () => {\r\n                if (checking)\r\n                    return;\r\n                checking = true;\r\n                // isAsync ? this.checkFieldAsync(field) : this.checkField(field);\r\n                if (isAsync) {\r\n                    this.checkFieldAsync(field)\r\n                        .then(() => checking = false)\r\n                        .catch(() => checking = false);\r\n                }\r\n                else {\r\n                    this.checkField(field);\r\n                    checking = false;\r\n                }\r\n            };\r\n        })();\r\n        if (this.validateOnChanged) {\r\n            element.addEventListener('change', validateFunc);\r\n            if (element.tagName != 'select') {\r\n                element.addEventListener('keyup', validateFunc);\r\n            }\r\n        }\r\n        this.elementEvents[field.name] = true;\r\n    }\r\n    checkField(field) {\r\n        this.bindElementEvent(field, false);\r\n        let element = this.fieldElement(field);\r\n        let depends = field.depends || [];\r\n        for (let j = 0; j < depends.length; j++) {\r\n            let dependResult = depends[j](element);\r\n            if (typeof dependResult == 'object') {\r\n                throw new Error('Please use checkAsync method.');\r\n            }\r\n            let dependIsOK = dependResult;\r\n            if (!dependIsOK)\r\n                return false;\r\n        }\r\n        for (let j = 0; j < field.rules.length; j++) {\r\n            let rule = field.rules[j];\r\n            let element = this.fieldElement(field);\r\n            if (element == null)\r\n                throw errors_1.errors.fieldElementCanntNull();\r\n            let value = FormValidator.elementValue(element);\r\n            let isPass = rule.validate(value);\r\n            if (typeof isPass == 'object') {\r\n                throw new Error('Please use checkAsync method.');\r\n            }\r\n            this.showElement(!isPass, field, rule, element);\r\n            if (!isPass)\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n    checkFieldAsync(field) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.bindElementEvent(field, true);\r\n            let element = this.fieldElement(field);\r\n            let depends = field.depends || [];\r\n            for (let j = 0; j < depends.length; j++) {\r\n                let dependResult = depends[j](element);\r\n                if (typeof dependResult == 'boolean') {\r\n                    dependResult = Promise.resolve(dependResult);\r\n                }\r\n                let dependIsOK = yield dependResult;\r\n                if (!dependIsOK)\r\n                    return false;\r\n            }\r\n            for (let j = 0; j < field.rules.length; j++) {\r\n                let rule = field.rules[j];\r\n                let element = this.fieldElement(field);\r\n                if (element == null)\r\n                    throw errors_1.errors.fieldElementCanntNull();\r\n                let value = FormValidator.elementValue(element);\r\n                let p = rule.validate(value);\r\n                if (typeof p == 'boolean') {\r\n                    p = Promise.resolve(p);\r\n                }\r\n                let isPass = yield p;\r\n                this.showElement(!isPass, field, rule, element);\r\n                if (!isPass)\r\n                    return false;\r\n            }\r\n            return true;\r\n        });\r\n    }\r\n    showElement(display, field, rule, element) {\r\n        let errorElement = this.fieldErrorElement(field);\r\n        console.assert(errorElement != null, 'errorElement cannt be null.');\r\n        if (rule.error != null) {\r\n            errorElement = field.errorElement;\r\n            let name = this.elementName(element);\r\n            let errorText = typeof rule.error == 'string' ? rule.error : rule.error() || '';\r\n            errorElement.innerHTML = errorText.replace('%s', name);\r\n        }\r\n        if (display) {\r\n            errorElement.style.removeProperty('display');\r\n        }\r\n        else {\r\n            errorElement.style.display = 'none';\r\n        }\r\n    }\r\n    /**\r\n     * 异步验证 HTML 元素\r\n     * @param name HTML 元素名称\r\n     */\r\n    checkElementAsync(name) {\r\n        let field = this.fields.filter(o => o.name == name)[0];\r\n        if (!field)\r\n            throw errors_1.errors.elementNotExists(name);\r\n        return this.checkFieldAsync(field);\r\n    }\r\n    /**\r\n     * 同步验证 HTML 元素\r\n     * @param name HTML 元素名称\r\n     */\r\n    checkElement(name) {\r\n        let field = this.fields.filter(o => o.name == name)[0];\r\n        if (!field)\r\n            throw errors_1.errors.elementNotExists(name);\r\n        return this.checkField(field);\r\n    }\r\n    static elementValue(element) {\r\n        if (element.tagName == \"TEXTAREA\") {\r\n            return element.value;\r\n        }\r\n        return element.value;\r\n    }\r\n    elementName(element) {\r\n        if (element.tagName == \"TEXTAREA\") {\r\n            return element.name;\r\n        }\r\n        return element.name;\r\n    }\r\n}\r\nexports.FormValidator = FormValidator;\r\nFormValidator.errorClassName = 'validationMessage';\r\n// }\r\n"],"file":"formValidator.js"}